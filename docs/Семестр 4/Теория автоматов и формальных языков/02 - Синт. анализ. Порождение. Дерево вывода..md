# Синтаксический анализ. Порождение. Дерево вывода.

Существуют два способа определения языка грамматики:
- Последовательность правил вывода - порождение от стартового символа к предложению языка.
- Построение дерева разбора/вывода.

## Порождение

Основная идея порождение состоит в том, что каждая продукция рассматривается как переписывающее правило в котором нетерминал из левой части заменяется строкой из правой части продукции.

#### Пример грамматики арифметических выражений:

$E \rightarrow E+E\ |\ E*E\ |\ (E)\ |\ -E\ |\ id$
$N = \{E\}$
$T=\{+,*,(,),-,id\}$
$S=E$

$E=-E$
- "Из Е выводится минус Е"
- "Е порождает минус Е"

$E \rightarrow \underset{1}{E+E}\ |\ \underset{2}{E*E}\ |\ \underset{3}{(E)}\ |\ \underset{4}{-E}\ |\ \underset{5}{id}$

Получение $-(id)$: $E \underset{4}{\Rightarrow} -E \underset{3}{\Rightarrow} -(E) \underset{5}{\Rightarrow} -(id)$

#### Определения

Последовательность - вывод/порождение строки $-(id)$ из стартового символа грамматики.

**Предложение языка** - строка терминальных символов, полученная в результате вывода (порождения) из стартового символа грамматики путём последовательности замен.

Сентенциальная форма содержит в своём составе любые символы - хоть терминалы, хоть не терминалы.

**Сентенциальная форма грамматики** - любая цепочка полученная из стартового символа грамматики.

Сентенциальная форма, которая содержит только терминальные символы является **предложением языка**.

Таким образом на каждом шаге порождения/вывода осуществляется два выбора:
- Выбирается заменяемый нетерминал *(только один)*
- Выбирается альтернатива для этого нетерминала

**Пример:**

$E \rightarrow \underset{1}{E+E}\ |\ \underset{2}{E*E}\ |\ \underset{3}{(E)}\ |\ \underset{4}{-E}\ |\ \underset{5}{id}$

$w = -(id+id)$

$E \underset{4}{\Rightarrow} -E \underset{3}{\Rightarrow} -(E) \underset{1}{\Rightarrow} -(E+E) \underset{5}{\Rightarrow} -(id+E) \underset{5}{\Rightarrow} -(id+id)$

В данном случае получается левостороннее порождение - на каждом шаге заменялся крайний левый нетерминал.

## Дерево разбора

Дерево разбора/вывода/привидения можно рассматривать как графическое представление порождения, из которого удалена информация о порядке замещения.

Дерево разбора - это конечный неориентированный граф, обладающий следующими свойствами:
1. У него одна вершина - корень дерева. Соответствует стартовому символу грамматики.
2. Каждый внутренний узел дерева помечается некоторым нетерминалом $A$.
3. Дочерние узлы помечаются слева направо символами из правой части продукции для $A$.
4. Листья дерева помеченные терминальными символами и будучи прочитанными слева направо

![Pasted image 20240207130104.png](../../Pasted%20image%2020240207130104.png#)

Для одной строки можно получить даже два и больше деревьев разбора, даже левосторонних.

**Пример:**

$w = id+id*id$
1. $E \Rightarrow E+E \Rightarrow id + E \Rightarrow id + E * E \Rightarrow id + id * E \Rightarrow id + id * id$
2. $E \Rightarrow E*E \Rightarrow E+E*E \Rightarrow id+E*E \Rightarrow id+id*E \Rightarrow id+id*id$

Предпочтительнее будет первый вариант, так как он соответствует приоритету математики в виде дерева приведения.

![Pasted image 20240207131512.png](../../Pasted%20image%2020240207131512.png#)

Первое отображает обычный приоритет операций умножения и сложения.

Грамматика, которая даёт более одного дерева разбора одной стороны *(например 2+ левых)* называется неоднозначной.

**Контекстно свободная грамматика** называется **однозначной** если для некоторой цепочки существует только одно дерево разбора.

Однозначность или неоднозначность - свойство грамматики, не языка.

Однозначные грамматики обеспечивают однозначную семантическую интерпретацию программы и получение машинного кода.

 Для **устранения неоднозначности** необходимо переписать грамматику, либо использовать новую.


## Преобразования грамматики в однозначную

#### 1. Устранение неоднозначности

В ЯП из двух вариантов предпочтительнее левый разбор, так как в языках правило гласит "Сопоставить каждое `else` ближайшему не занятому `then`". Эта идея может быть встроена в грамматику для устранения неоднозначности.

Основная идея заключается в том, что инструкция, появляющаяся между `then` и `else` "сбалансированная" - не должна оканчиваться на `then` не соответствующее некоторому `else`.

**Неоднозначная грамматика:**

$S \rightarrow if\ E\ then\ S\ |\ if\ E\ then\ S\ else\ S\ |\ other$

**Однозначная грамматика:**

$S \rightarrow S1\ |\ S2$  
$S1 \rightarrow if\ E\ then\ S1\ else\ S1\ |\ other$  
$S2 \rightarrow if\ E\ then\ S\ |\ if\ E\ then\ S1\ else\ S2$


#### 2. Левая факторизация

Актуально для нисходящих анализаторов.

Основная идея левой факторизации заключается в том, что когда не ясно какая из двух альтернативных продукций должна использоваться для некоторого нетерминала $A$, продукции для нетерминала $A$ переписываются так, чтобы отложить принятие решения до тех пор пока из входного потока не будет прочитано достаточно символов для правильного выбора.

$A \rightarrow \alpha \beta_1\ |\ \alpha \beta_2$

Сменяется на

$A \rightarrow \alpha A'$  
$A' \rightarrow \beta_1\ |\ \beta_2$


#### 3. Устранение левой рекурсии

Грамматикая является лево-рекурсивной если в ней имеется нетерминал $A$ такой, что $A \Rightarrow A\alpha$ (явная левая рекурсия в продукции), $A \rightarrow A\beta$ (рекурсивное произведение).

$E \rightarrow E + T\ |\ T$  
$T \rightarrow T*F\ |\ F$  
$F \rightarrow (E)\ |\ id$


Для замены обозначаем как $\alpha$ и $\beta$ символы:


$E \rightarrow E + \underbrace{T}_{\alpha}\ |\ \underbrace{T}_{\beta}$  
$T \rightarrow T*\underbrace{F}_{\alpha}\ |\ \underbrace{F}_{\beta}$  
$F \rightarrow (E)\ |\ id$

И преобразуем

$E\rightarrow TE'$  
$E' \rightarrow +TE'\ |\ \varepsilon$  
$T\rightarrow FT'$  
$T'\rightarrow *FT'\ |\ \varepsilon$  
$F\rightarrow (E)\ |\ id$

Если грамматика содержит некоторое количество леворекурсивных правил для одного и того же нетерминала более одного, то алгоритм устранения следующий:
1. Группируются все леворекурсивные правила.  
	$A \rightarrow A\alpha_1\ |\ A\alpha_2\ |\ A\alpha_{n}$
2. Делается замена $A'$ и дописывается продукция $\varepsilon$.

#### 4. Устранение недостижимых символов

Нетерминальный символ $X$ является недостижимым, если:
1. $X \ne S$
2. Не существует вывода вида $S \Rightarrow \alpha X\beta \text{ при } \alpha, \beta \in V^*$  
	То есть символ никогда не появляется в правой части производимой цепочки

Решается алгоритмом, в лекции не приводимом

#### 5. Устранение бесполезных символов

**Бесполезный символ** - нетерминальный символ, для которого не существует вывода: $S \Rightarrow \alpha X \beta \Rightarrow \alpha x \beta$

Такие символы не играют роли в построении цепочек грамматики.

#### 6. Устранение $\varepsilon$-продукций

Контекстно свободная грамматика называется эпсилон-свободной если в множестве её правил отсутствует такое, в котором выводится $\varepsilon$, либо существует ровно одно правило, в котором из $S$ выводится $\varepsilon$ и $S$ не встречается в правых частях остальных продукций

#### 7. Устранение цепных правил

КС-грамматика называется **без циклов**, если в ней нет вывода вот такого вида: $A \Rightarrow A$  $A \in N$ 

#### Итог

Эквивалентные преобразования в итоге:
1. Обеспечивают однозначность и детерминированность грамматического разбора.
2. Устраняют лишние шаги в дереве разбора.
3. Преобразования обеспечивают простые критерии в выборе продукций из множества альтернативных.

## Проблемы разрешимости

Доказано, что проблема эквивалентности грамматик в общем случае алгоритмически неразрешима. Это означает, что не существует алгоритма, который бы позволял проверить являются ли две заданные грамматики эквивалентными. Такой алгоритм и не может быть создан.

Не разрешима в общем виде и проблема однозначности грамматик.
Это означает что не существует и не будет существовать алгоритм, который позволял бы для произвольной грамматики ответить на вопрос, однозначна она или нет. Это не означает, что проблема неразрешима вообще - для некоторых классов она решается, например, для регулярных грамматик.

Основная цель преобразования грамматик:
1. Упрощение правил грамматики.
2. Облегчение создания распознавателя языка.

Грамматика, к которой применены эквивалентные преобразования в определённом порядке называется **приведённой грамматикой**.

Преобразования должны быть выполнены в следующем порядке:
1. Устранение бесполезных символов.
2. Устранение недостижимых символов.
3. Устранение $\varepsilon$-продукций.
4. Удаление цепных правил.
