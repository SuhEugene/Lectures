# Язык SQL

Язык SQL — это язык управления базами данных, не процедурный язык, а язык, который позволяет ставить цели с помощью внутренних средств.

SQL (середина 70-х) был разработан в рамках проекта System R. Он стал полным языком для работы с базами данных.

Стандартизация SQL была необходима для того, чтобы сделать едиными требования к процессу развития этого языка.

История версий:
- SQL-1 или SQL-89
- SQL-2 или SQL-92
- SQL-3 или SQL-99
- ...

В SQL-89 определены способы взаимодействия баз данных и прикладных программ, написанных на традиционных языках программирования, таких как Fortran, Cobol, Pascal и C.

Способы взаимодействия:
1. Операторы собираются в модуль. Используется как процедура. Прикладная программа вызывает процедуру модуля, передаёт фактические параметры и получает ответ. Модуль компилируется отдельно от прикладной программы и появляется набор необходимых транзакций.
2. SQL-операторы могут использоваться на языках программирования, обмен данными происходит через переменные.

SQL компилируется каждый раз при их использовании, точнее, при каждой первой исходной операции.

Достоинство модульной организации заключается в том, что прикладные программы имеют чёткое взаимодействие с СУБД, что позволяет локализовать изменения.

Недостаток заключается в том, что для понимания смысла прикладной программы требуется чтение двух текстов, а синтаксис модулей может быть разным.

Встроенный SQL делает прикладную программу более самодостаточной, так как каждый встроенный SQL оператор единообразен и соответствует синтаксису SQL, что упрощает взаимодействие с различными базами данных.

Типы данных

| Тип                                               | Идентификатор                              | Размер                                                         | Диапазон                                           |
| ------------------------------------------------- | ------------------------------------------ | -------------------------------------------------------------- | -------------------------------------------------- |
| `int` (`integer`)                                 | `integer`                                  | 4 байт                                                         | $-2^{31}$ ... $2^{31}$                             |
| `small int`                                       |                                            | 2 байта                                                        | $-32768$ ... $32767$                               |
| `tiny int`                                        |                                            | 1 байт                                                         | $0$ ... $255$                                      |
| Упакованные десятичные (точные числовые значения) | `numeric(P,S)` (`decimal`)                 | В зависимости от заданной точности (до 32 знаков)<br>2-17 байт | Целые, дробные числа                               |
| С плавающей точкой (приблизительные числа)        | `float(n)` (`float`)                       | 8 байт                                                         | Точность от 8 до 15 знаков                         |
| С плавающей точкой (приблизительные числа)        | `real(float(n))`                           | 4 байт                                                         | Точность от 1 до 7 знаков                          |
| Символьные фиксированной длины                    | `char[(n)]` (`character[(n)]`)             | `n` байт                                                       | $0$ ... $255$                                      |
| Символьные переменной длины                       | `varchar(n)` (`character`<br>`varying(n)`) | По 1 байту на каждый символ                                    | $0$ ... $255$                                      |
| Дата и время                                      | `datatime`                                 | 8 байт                                                         | 01.01.1753 - 31.12.9999г.                          |
| Дата и время                                      | `smalldatetime`                            | 4 байта                                                        | 01.01.1900 - 06.06.2079                            |
| Денежные суммы                                    | `money`                                    | 8 байт                                                         | До 4 знаков после запятой<br>$-922тр.$ ... $922тр$ |
| Денежные суммы                                    | `smallmoney`                               | 4 байт                                                         | До 4 знаков после запятой<br>$-214тр.$ ... $215тр$ |
| Двоичный фиксированной длины                      | `binary(n)`                                | n байт                                                         | До 255 байт                                        |
| Двоичный переменной длины                         | `varbinary(n)`                             | n хранящихся байт                                              | До 255 байт                                        |
| Длинный текст                                     | `text`                                     | 2 ГБ                                                           |                                                    |
| Булево значение                                   | `bit`                                      | Значение поля совмещается с другими. На 8 записей 1 байт       | $0$, $1$                                           |
В именовании полей использовалась венгерская нотация.

### Операторы SQL


**Примечание:**  `[]` - указывать необязательно.

- **Создание таблицы**:  
  ```sql
  CREATE TABLE имя_таблицы (имя_п1 тип, ..., имя_пN тип);
  ```
  или  
  ```sql
  CREATE TABLE {database_name.schema_name.table_name | schema_name.table_name | table_name} ({<column_definition>}, [...n]) [знак действия];
  ```

- **Изменение таблицы**:  
  ```sql
  ALTER TABLE имя_таблицы (ADD | MODIFY | DROP имя_п1 [тип] [N | NII]);
  ```

- **Удаление таблицы**:  
  ```sql
  DROP TABLE имя_таблицы;
  ```

- **Индексы**:  
  ```sql
  CREATE INDEX имя_индекса ON имя_таблицы (имя_поля);
  ```

- **Представления**:  
  ```sql
  CREATE VIEW имя_представления AS SELECT ...;
  ```

- **Вставка новой записи**:  
  ```sql
  INSERT INTO имя_таблицы [(список_полей)] VALUES (список_значений);
  ```

- **Выборка записей**:  
  ```sql
  SELECT ... FROM имя_таблицы;
  ```

- **Обновление записей**:  
  ```sql
  UPDATE имя_таблицы SET имя_поля = выражение, имя_поля = выражение;
  ```
  - `UPDATE` — оператор, `SET` — служебное слово (операнд).
  - `WHERE` изменяет значение в полях, указанных для записи, удовлетворяющих условию.

- **Удаление записей**:  
  ```sql
  DELETE FROM имя_таблицы [WHERE условие];
  ```

### DQL (Data Query Language)

```sql
SELECT [ALL | DISTINCT]
список_полей
FROM список_таблиц [WHERE условие]
[GROUP BY имя_п1, ..., имя_пn]
[HAVING условие_поиска]
[ORDER BY спецификация];
```

- **Производит выборку и вычисления над данными** из указанных таблиц.  
- Результат выполнения — проекция таблицы, которая может иметь (ALL) или не иметь (DISTINCT) повторяющиеся строки.

В отборе участвуют записи из таблиц, указанных после `FROM`. `список_полей` содержит имена полей, участвующих в запросе, а также выражения над полями. В списке полей из разных таблиц перед именем поля ставится `имя_таблицы.имя_поля`.