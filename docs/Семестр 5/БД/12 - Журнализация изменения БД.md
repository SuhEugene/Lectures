# Журнализация изменения БД

Для восстановления согласованного состояния БД после аппаратного или программного сбоя поддерживается журнал изменений БД.

Ситуации, для которых требуется восстановление:
1. Откат транзакции завершается `ROLLBACK`.
2. Откат потери системы.
3. Исключительная ситуация в программе.
4. Выбор транзакции в качестве жертвы.
5. Потеря содержимого ОЗУ при мягком сбое.
6. При аварийном выключении питания и сбое процесса.
7. Поломка ВЗУ, жёсткий сбой.

В основе восстановления хранится избыточность данных и архивная копия.

### Восстановление после мягкого сбоя

Журнал изменений отмечает точки физической согласованности. Это те моменты времени, когда во внешней памяти содержится согласованный результат операций, завершённых до мягкого сбоя, и отсутствуют результаты операций, которые не завершились.

![Pasted image 20250120194827.png](../../Pasted%20image%2020250120194827.png#)

Что сделано для восстановления БД:
- $T_1$ ничего не делает, результат отображается. $T_1$ завершён до точки физической согласованности.
- $T_2$ — повтор выполнения оставшейся части транзакции (Redo).
- $T_3$ выполняется в обратном направлении: часть операций, в ВЗУ нет результатов $T_3$, которые выполнены после точки физической согласованности, но есть результаты до.
- $T_4$ началось после точки физической согласованности и по закону до мягкого сбоя — нужно полное повторение (прямая интерпретация команд Undo).
- $T_5$ - не поможет, так как результатов нет во внешней памяти.

> Про жёсткий сбой и горячую замену